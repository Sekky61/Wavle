---
import WaveControls from './WaveControls.astro';
import WaveRenderer from './WaveRenderer.astro';
---

<div class="game-board">
  <WaveRenderer />
  <WaveControls />
</div>

<script>
  import { createInitialState, initializeGame, addPlayerWave, removePlayerWave, generateTargetWaves, compareSignals } from '../scripts/game.js';
  
  let gameState = createInitialState();
  gameState = initializeGame(gameState, 1); // Start with difficulty 1

  function updateDisplay() {
    if (window.updateWaves) {
      window.updateWaves(gameState.playerWaves, gameState.targetWaves);
    }
  }

  // Initial display update
  updateDisplay();

  // Example of adding a player wave
  document.addEventListener('addWave', (event) => {
    const newWave = event.detail;
    gameState = addPlayerWave(gameState, newWave);
    updateDisplay();
  
    const similarity = compareSignals(gameState.playerWaves, gameState.targetWaves);
    console.log(`Current similarity: ${similarity}%`);
  
    if (similarity >= 95) {
      console.log("Congratulations! You've matched the target wave!");
      // Handle win condition
    }
  });

  // Example of removing a player wave
  document.addEventListener('removeWave', (event) => {
    const index = event.detail;
    gameState = removePlayerWave(gameState, index);
    updateDisplay();
  });

  // Example of changing difficulty
  document.addEventListener('changeDifficulty', (event) => {
    const difficulty = event.detail;
    gameState = initializeGame(gameState, difficulty);
    updateDisplay();
  });
</script>

<style>
  .game-board {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    background-color: #f0f0f0;
    border-radius: 1rem;
  }
</style>
